<%_ include partials/header _%>
    <main>
        <div id="overview" style="height: 90vh">
            <script src="/js/galleria-init.js"></script>
            <script>
                var isLandscape, data, initialHeight = "90vh";
                $(window).on("load resize", function() {
                    if ( isLandscape !== window.innerWidth >= window.innerHeight ) {
                        var g = $("#overview").data("galleria");
                        isLandscape = window.innerWidth >= window.innerHeight;
                        $.post("/p", {
                            photo_set: "Assorted",
                            orientation: isLandscape ? "landscape" : undefined,
                            sort: '{"index": 1}'
                        }, function(d) {
                            if (g) g.destroy();
                            data = d;
                            $("#overview").html(d.map(function(e) { return "<img src='"+ e.photo_url +"'>" }).join("")).galleria({
                                imageCrop: isLandscape,
                                autoplay: true,
                                showImagenav: false,
                                transitionSpeed: 1000,
                                imagePosition: !isLandscape ? "top center" : undefined,
                                swipe: "disabled"
                            }).css("height", initialHeight);
                            var img = new Image();
                            img.src = d[0] ? d[0].photo_url : "";
                            img.onload = function() {
                                var landscape = img.width >= img.height;
                                var height = !isLandscape ? (img.height / img.width) * window.innerWidth : initialHeight;
                                $("#overview").css({ height, transition: ".5s height" }).data("galleria").resize({ height }).setOptions({ imageCrop: landscape }).refreshImage();
                            };
                        });
                    }
                });
                Galleria.on("image", function() {
                    var g = this;
                    var i = g.getIndex() !== data.length-1 ? g.getIndex()+1 : 0;
                    if (!isLandscape) {
                        try {
                            setTimeout(function() {
                                var img = new Image();
                                img.src = data[i] ? data[i].photo_url : "";
                                img.onload = function() {
                                    var landscape = img.width >= img.height;
                                    var height = (img.height / img.width) * window.innerWidth;
                                    $("#overview").css({ height, transition: ".5s height" });
                                    g.resize({ height }).setOptions({ imageCrop: landscape }).refreshImage();
                                };
                            }, 4000)
                        } catch(err) {}
                    }
                })
            </script>
        </div>
    </main>
<%_ include partials/footer _%>
